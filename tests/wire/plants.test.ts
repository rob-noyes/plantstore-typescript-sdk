/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../mock-server/MockServerPool";
import { PlantStoreClient } from "../../src/Client";
import * as PlantStore from "../../src/api/index";

describe("Plants", () => {
    test("create (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new PlantStoreClient({ environment: server.baseUrl });
        const rawRequestBody = { name: "Fern", category: "Indoor", tags: ["green", "leafy"], status: "available" };
        const rawResponseBody = { id: 101, name: "Fern", status: "available", tags: ["green", "leafy"] };
        server
            .mockEndpoint()
            .post("/plant")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.plants.create({
            name: "Fern",
            category: "Indoor",
            tags: ["green", "leafy"],
            status: "available",
        });
        expect(response).toEqual({
            id: 101,
            name: "Fern",
            status: "available",
            tags: ["green", "leafy"],
        });
    });

    test("create (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new PlantStoreClient({ environment: server.baseUrl });
        const rawRequestBody = { name: undefined, category: undefined, tags: undefined, status: undefined };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/plant")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(405)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plants.create({
                name: undefined,
                category: undefined,
                tags: undefined,
                status: undefined,
            });
        }).rejects.toThrow(PlantStore.MethodNotAllowedError);
    });

    test("update (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new PlantStoreClient({ environment: server.baseUrl });
        const rawRequestBody = { name: "Fern", category: "Indoor", tags: ["green", "leafy"], status: "sold" };
        const rawResponseBody = { id: 101, name: "Fern", status: "sold", tags: ["green", "leafy"] };
        server
            .mockEndpoint()
            .put("/plant")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.plants.update({
            name: "Fern",
            category: "Indoor",
            tags: ["green", "leafy"],
            status: "sold",
        });
        expect(response).toEqual({
            id: 101,
            name: "Fern",
            status: "sold",
            tags: ["green", "leafy"],
        });
    });

    test("update (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new PlantStoreClient({ environment: server.baseUrl });
        const rawRequestBody = { name: undefined, category: undefined, tags: undefined, status: undefined };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .put("/plant")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plants.update({
                name: undefined,
                category: undefined,
                tags: undefined,
                status: undefined,
            });
        }).rejects.toThrow(PlantStore.BadRequestError);
    });

    test("update (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new PlantStoreClient({ environment: server.baseUrl });
        const rawRequestBody = { name: undefined, category: undefined, tags: undefined, status: undefined };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .put("/plant")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.plants.update({
                name: undefined,
                category: undefined,
                tags: undefined,
                status: undefined,
            });
        }).rejects.toThrow(PlantStore.NotFoundError);
    });

    test("listByStatus", async () => {
        const server = mockServerPool.createServer();
        const client = new PlantStoreClient({ environment: server.baseUrl });

        const rawResponseBody = [
            { id: 101, name: "Fern", status: "available", tags: ["green", "leafy"] },
            { id: 102, name: "Palm", status: "available", tags: ["tropical"] },
        ];
        server
            .mockEndpoint()
            .get("/plant/search/status")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.plants.listByStatus();
        expect(response).toEqual([
            {
                id: 101,
                name: "Fern",
                status: "available",
                tags: ["green", "leafy"],
            },
            {
                id: 102,
                name: "Palm",
                status: "available",
                tags: ["tropical"],
            },
        ]);
    });

    test("listByTags", async () => {
        const server = mockServerPool.createServer();
        const client = new PlantStoreClient({ environment: server.baseUrl });

        const rawResponseBody = [
            { id: 101, name: "Fern", status: "available", tags: ["green", "leafy"] },
            { id: 103, name: "Cactus", status: "available", tags: ["spiky", "desert"] },
        ];
        server.mockEndpoint().get("/plant/search/tags").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.plants.listByTags();
        expect(response).toEqual([
            {
                id: 101,
                name: "Fern",
                status: "available",
                tags: ["green", "leafy"],
            },
            {
                id: 103,
                name: "Cactus",
                status: "available",
                tags: ["spiky", "desert"],
            },
        ]);
    });

    test("get", async () => {
        const server = mockServerPool.createServer();
        const client = new PlantStoreClient({ environment: server.baseUrl });

        const rawResponseBody = { id: 101, name: "Fern", status: "available", tags: ["green", "leafy"] };
        server.mockEndpoint().get("/plant/1").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.plants.get({
            plantId: 1,
        });
        expect(response).toEqual({
            id: 101,
            name: "Fern",
            status: "available",
            tags: ["green", "leafy"],
        });
    });
});
